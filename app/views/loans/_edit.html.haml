.modal-header
  %h5.modal-title Edit Loan #{@loan.lead.name}
  %button.close{"aria-label" => "Close", "data-dismiss" => "modal", :type => "button"}
    %span{"aria-hidden" => "true"} Ã—
.modal-body
  = bootstrap_form_for @loan, remote: true do |f|
    - if @loan.errors.any?
      #error_explanation
        %h2
          = pluralize(@loan.errors.count, "error")
          prohibited this Lead from being saved:
        %ul
          - @loan.errors.full_messages.each do |message|
            %li= message
    .row
      - users = @company.users.loan_enabled
      .col-md-4{class: ("required")}
        .form-group
          = f.select :user_id, options_from_collection_for_select(users.order('name'), :id, :name, (@loan.user_id || nil)), {prompt: true, label: 'Assign To'}, class: 'form-control', required: true
      .col-md-4{class: ("required")}
        .form-group
          = f.select :status_id, options_from_collection_for_select(Status.of_loans, :id, :name, (@loan.status_id || nil)), {prompt: true, label: 'Status'}, class: 'form-control', required: true, data: {dead_status_id: ::Loan::DEAD_LOAN_IDS}
      .col-md-4#ncd
        .form-group
          = f.text_field :ncd, :value=>(Time.zone.parse(@loan.ncd.to_s).to_s rescue nil), class: "form-control datetimepickerncd_modal", placeholder: "Next Call Date", label: "Next Call Date"
    .w-100
      .col-md-12#dead-reason{:style => ("display:none;" unless ::Loan::DEAD_LOAN_IDS.include?(f.object.status_id))}
        .row
          .col-md-6.required
            .form-group
              = f.select :dead_reason_id, options_from_collection_for_select(@company.reasons.active, :id, :reason, f.object.dead_reason_id), {include_blank: "Dead Reason"},{class: "form-control multiselect"}
          .col-md-6
            .form-group
              = f.text_field :dead_sub_reason, class: "form-control", placeholder: "Sub Reason"
    .w-100
      .form-group.col-md-12
        %span.lead-title Comment
        %span.lead-info
          = f.object.comment&.gsub(/\n/, '<br/>')&.html_safe
          = f.text_area :comment, class: "form-control", value: '', placeholder: "Comment", rows: "4", hide_label: true
    %div
      .col-md-12
        .form-group
          = button_tag type: "submit", class: "btn btn-primary", data: {disable_with: "Please Wait..."} do
            = fa_icon "floppy-o"
            Save
          = link_to :back, class: "btn btn-danger" do
            = fa_icon "close"
            Cancel

:javascript
  var deadReasonIds = $("#loan_status_id").data('dead-status-id');
  $("#loan_status_id").on("change", function(e){
    var statusId = parseInt($(this).val());
    if (deadReasonIds.includes(statusId)){
      $('#dead-reason').show();
    }else{
      $('#dead-reason').hide();
    }
  });